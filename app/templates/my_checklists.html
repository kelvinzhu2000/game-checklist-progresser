{% extends "base.html" %}

{% block title %}My Checklists - Game Checklist Progresser{% endblock %}

{% block content %}
<div class="page-header">
    <h1>My Checklists{% if selected_game %} - {{ selected_game }}{% endif %}</h1>
    <div class="game-context">
        {% if selected_game %}
        <p>Viewing checklists for: <strong>{{ selected_game }}</strong></p>
        <a href="{{ url_for('main.my_games') }}" class="btn btn-secondary">Switch Game</a>
        {% endif %}
    </div>
</div>

<section class="my-created">
    <h2>Created by Me</h2>
    {% if created %}
    <div class="checklist-grid">
        {% for checklist in created %}
        <div class="checklist-card">
            <h3><a href="{{ url_for('checklist.view', checklist_id=checklist.id) }}">{{ checklist.title }}</a></h3>
            <p class="game-name">{{ checklist.game.name }}</p>
            <p class="item-count">{{ checklist.items.count() }} items</p>
            <p class="copies">{{ checklist.user_copies.count() }} copies</p>
            <p class="visibility">{% if checklist.is_public %}Public{% else %}Private{% endif %}</p>
            <form method="POST" action="{{ url_for('checklist.delete', checklist_id=checklist.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this checklist? This will remove it for everyone who copied it.');">
                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>You haven't created any checklists yet. <a href="{{ url_for('checklist.create') }}">Create one now!</a></p>
    {% endif %}
</section>

<section class="my-copied">
    <h2>My Progress Tracking</h2>
    {% if copied %}
    <div class="checklist-grid">
        {% for user_checklist in copied %}
        <div class="checklist-card">
            <h3><a href="{{ url_for('checklist.view', checklist_id=user_checklist.checklist_id) }}">{{ user_checklist.original_checklist.title }}</a></h3>
            <p class="game-name">{{ user_checklist.original_checklist.game.name }}</p>
            <p class="progress-percentage">Progress: {{ user_checklist.get_progress_percentage() }}%</p>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ user_checklist.get_progress_percentage() }}%"></div>
            </div>
            <form method="POST" action="{{ url_for('checklist.delete_copy', checklist_id=user_checklist.checklist_id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to remove this checklist? Your progress will be lost.');">
                <button type="submit" class="btn btn-danger btn-sm">Remove</button>
            </form>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>You haven't copied any checklists yet. <a href="{{ url_for('main.browse') }}">Browse and copy some!</a></p>
    {% endif %}
</section>
{% endblock %}
